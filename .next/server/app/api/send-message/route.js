(()=>{var e={};e.id=287,e.ids=[287],e.modules={62849:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=62849,e.exports=r},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},6005:e=>{"use strict";e.exports=require("node:crypto")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},85477:e=>{"use strict";e.exports=require("punycode")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},13324:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>E,staticGenerationAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{POST:()=>m});var i=t(49303),o=t(88716),a=t(60670),n=t(57357),u=t(36352),c=t(62458),p=t(14300),l=t(49788);l.v2.config({cloud_name:"dn5yraber",api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});let d=l.v2;async function m(e){try{let{prompt:r}=await e.json();if(!r)return Response.json({error:"No prompt provided"});let t=e.headers.get("Authorization"),s=t?.split(" ")[1]||"",i=await (0,n.P)(s),o=i?i.sub:null,a=(0,u.DO)(),l=r.trim().substring(0,880),m=await fetch("https://api-inference.huggingface.co/models/black-forest-labs/FLUX.1-dev",{headers:{Authorization:`Bearer ${process.env.HUGGING_FACE_TOKEN}`,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({inputs:r})});if(!m.ok){let e=await m.text();throw Error(`HTTP error! status: ${m.status}, message: ${e}`)}let h=await m.blob(),g=await new Promise((e,r)=>{new Response(h).arrayBuffer().then(r=>{let t=p.Buffer.from(r).toString("base64");e(t)}).catch(()=>{r(Error("Error reading the file."))})}),f=(await d.uploader.upload(`data:image/jpeg;base64,${g}`,{resource_type:"auto",upload_preset:"ml_default"})).secure_url,E={sub:o,token:a,uri:f,prompt:l},x=await (0,c.v_)(["INSERT INTO images (sub, uri, prompt, token) VALUES (?, ?, ?, ?)",[E.sub,E.uri,E.prompt,E.token]],"images");if(x)return Response.json({image:x},{status:201});throw Error("An unexpected error occurred while saving the image")}catch(e){return Response.json({message:"Failed to send message",error:e.message},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/send-message/route",pathname:"/api/send-message",filename:"route",bundlePath:"app/api/send-message/route"},resolvedPagePath:"C:\\Users\\hp\\Desktop\\projects\\picxob.borislukrece.com\\picxob\\src\\app\\api\\send-message\\route.tsx",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:E}=h,x="/api/send-message/route";function v(){return(0,a.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:f})}},62458:(e,r,t)=>{"use strict";t.d(r,{U2:()=>u,v_:()=>c});var s=t(36352),i=t(69518);let o=(0,s.uj)(),a=(0,i.createPool)({host:o.DB_HOST,user:o.DB_USER,password:o.DB_PASSWORD,database:o.DB_NAME,waitForConnections:!0,connectionLimit:10,queueLimit:0});async function n(e,r){let t="",s=[];switch("string"==typeof e?t=e:Array.isArray(e)&&(t=e[0],s=e[1]||[]),r){case"get":if(!t.startsWith("SELECT"))throw Error("Invalid SQL statement");break;case"post":if(!t.startsWith("INSERT INTO"))throw Error("Invalid SQL statement");break;case"update":if(!t.startsWith("UPDATE"))throw Error("Invalid SQL statement");break;case"delete":if(!t.startsWith("DELETE"))throw Error("Invalid SQL statement")}let[i]=await a.query(t,s);return i}async function u(e){return await n(e,"get")}async function c(e,r=null){let t=await n(e,"post");return await new Promise(async e=>{try{if(r){let s=await u([`SELECT * FROM ${r} WHERE id = ? LIMIT 1`,[t.insertId]]);Array.isArray(s)&&s.length>0&&e(s[0])}else e(null)}catch(r){console.log("Error getting item added: ",r.message),e(null)}})}},57357:(e,r,t)=>{"use strict";t.d(r,{P:()=>i});let s=new(t(33064)).lv(process.env.GOOGLE_CLIENT_ID);async function i(e){return await new Promise(async r=>{try{let t=(await s.verifyIdToken({idToken:e||"",audience:process.env.GOOGLE_CLIENT_ID})).getPayload();r(t&&void 0!==t?t:null)}catch(e){r(null)}})}},36352:(e,r,t)=>{"use strict";t.d(r,{DO:()=>i,FX:()=>o,uj:()=>a});var s=t(9576);function i(){let e=(0,s.Z)();return`${e}`}function o(){return"https://picxob.borislukrece.pro"}function a(){return{DB_HOST:process.env.DB_HOST,DB_USER:process.env.DB_USER,DB_NAME:process.env.DB_NAME,DB_PASSWORD:process.env.DB_PASSWORD}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,766,64,788],()=>t(13324));module.exports=s})();